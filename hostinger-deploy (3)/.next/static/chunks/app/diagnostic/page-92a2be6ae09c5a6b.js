(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2620,8525],{1796:(e,t,r)=>{Promise.resolve().then(r.bind(r,3356))},3356:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var a=r(5155),s=r(2115),n=r(63),i=r(9730),l=r(9981);function o(){let{user:e}=(0,i.A)(),t=(0,n.useRouter)(),[r,o]=(0,s.useState)(""),[c,u]=(0,s.useState)([]);(0,s.useEffect)(()=>{d()},[e]);let d=()=>{let t="\uD83D\uDD0D DIAGNOSTIC COMPLET\n";t+="====================\n\n",t+="\uD83D\uDC64 UTILISATEUR:\n",t+="• Connect\xe9: ".concat(e?"✅ Oui":"❌ Non","\n"),t+="• ID: ".concat((null==e?void 0:e.id)||"N/A","\n"),t+="• Email: ".concat((null==e?void 0:e.email)||"N/A","\n\n"),t+="\uD83D\uDCBE LOCALSTORAGE ANALYSE:\n";let r=[];for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);t&&r.push(t)}if(t+="• Total cl\xe9s: ".concat(r.length,"\n"),t+="• Cl\xe9s trouv\xe9es: ".concat(r.join(", "),"\n\n"),e){t+="\uD83D\uDED2 COMMANDES:\n";try{let r=l.a.getUserOrders(e.id);t+="• Nombre de commandes: ".concat(r.length,"\n"),r.forEach((e,r)=>{t+="  ".concat(r+1,". ").concat(e.id," - ").concat(e.status," - ").concat(e.total,"€\n"),t+="     Date: ".concat(e.date,"\n"),t+="     Produits: ".concat(e.products.length,"\n"),e.id.includes("CMD-")&&!e.id.includes("cs_test_")&&(t+="     ⚠️  POSSIBLE COMMANDE MOCK\xc9E\n"),e.id.includes("cs_test_")&&(t+="     \uD83D\uDCB3 COMMANDE STRIPE\n")}),u(r)}catch(e){t+="❌ Erreur: ".concat(e,"\n")}}else t+="❌ Pas d'utilisateur connect\xe9\n";if(t+="\n\uD83D\uDCCA STATS UTILISATEUR:\n",e)try{let r=l.a.getUserStats(e.id);t+="• Stats trouv\xe9es: ".concat(r?"✅ Oui":"❌ Non","\n"),r&&(t+="• Total commandes: ".concat(r.totalOrders,"\n"),t+="• Total d\xe9pens\xe9: ".concat(r.totalSpent,"€\n"),t+="• Points fid\xe9lit\xe9: ".concat(r.loyaltyPoints,"\n"))}catch(e){t+="❌ Erreur stats: ".concat(e,"\n")}t+="\n\uD83D\uDD0D DONN\xc9ES BRUTES:\n";let a=localStorage.getItem("flocon_orders");if(a)try{let e=JSON.parse(a);t+="• Commandes brutes: ".concat(Array.isArray(e)?e.length:"N/A","\n"),t+="• Type: ".concat(Array.isArray(e)?"Array":typeof e,"\n"),Array.isArray(e)&&e.forEach((e,r)=>{t+="  ".concat(r+1,". ID: ").concat(e.id,", User: ").concat(e.userId,"\n")})}catch(e){t+="❌ Erreur parsing: ".concat(e,"\n")}else t+="• Aucune donn\xe9e brute trouv\xe9e\n";o(t)};return(0,a.jsx)("div",{className:"pt-28 min-h-screen bg-cream px-4 py-12",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-textDark mb-2",children:"\uD83D\uDD0D Diagnostic Dashboard"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Analyse compl\xe8te pour trouver les donn\xe9es mock\xe9es"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"\uD83D\uDCCB R\xe9sultats"}),(0,a.jsx)("pre",{className:"text-xs bg-gray-50 p-4 rounded-lg overflow-auto max-h-96",children:r})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"\uD83D\uDED2 Commandes d\xe9taill\xe9es"}),(0,a.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:c.map((e,t)=>(0,a.jsx)("div",{className:"border-b pb-2",children:(0,a.jsxs)("div",{className:"font-mono text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"font-medium",children:e.id}),(0,a.jsx)("span",{className:e.id.includes("cs_test_")?"text-purple-600":"text-green-600",children:e.id.includes("cs_test_")?"\uD83D\uDCB3 Stripe":"\uD83D\uDFE2 Test"})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:[e.status," • ",e.total,"€ • ",e.items," articles"]}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.date})]})},t))})]})]}),(0,a.jsxs)("div",{className:"mt-8 flex gap-4 flex-wrap",children:[(0,a.jsx)("button",{onClick:d,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"\uD83D\uDD04 Relancer diagnostic"}),(0,a.jsx)("button",{onClick:()=>{if(confirm("NETTOYAGE COMPLET - \xcates-vous s\xfbr ?")){let e=[];for(let t=0;t<localStorage.length;t++){let r=localStorage.key(t);r&&(e.push(r),localStorage.removeItem(r))}alert("✅ ".concat(e.length," cl\xe9s supprim\xe9es! Rechargement...")),window.location.reload()}},className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"\uD83E\uDDF9 Nettoyage complet"}),(0,a.jsx)("button",{onClick:()=>t.push("/dashboard"),className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"\uD83C\uDFE0 Dashboard"}),(0,a.jsx)("button",{onClick:()=>t.push("/clean-data"),className:"px-6 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors",children:"\uD83E\uDDF9 Nettoyage normal"})]})]})})}},8525:(e,t,r)=>{"use strict";r.d(t,{createClient:()=>s});var a=r(5417);function s(){let e="https://xvczqjkmbfpjkdghvomc.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh2Y3pxamttYmZwamtkZ2h2b21jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0MjA5MjUsImV4cCI6MjA4NDk5NjkyNX0.Qi9gHILEaBylF8ObdcpXqg9n8wrlX46MFSzlIcZbCG0";return e&&t?(0,a.createBrowserClient)(e,t):null}},9730:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,AuthProvider:()=>o});var a=r(5155),s=r(2115),n=r(8525),i=r(63);let l=(0,s.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,s.useState)(null),[c,u]=(0,s.useState)(null),[d,h]=(0,s.useState)(!0),m=(0,i.useRouter)(),g=(0,n.createClient)();(0,s.useEffect)(()=>{if(!g)return void h(!1);let{data:{subscription:e}}=g.auth.onAuthStateChange((e,t)=>{var r;u(t),o(null!=(r=null==t?void 0:t.user)?r:null),h(!1)});return(async()=>{var e;let{data:{session:t}}=await g.auth.getSession();u(t),o(null!=(e=null==t?void 0:t.user)?e:null),h(!1)})(),()=>{e.unsubscribe()}},[g,m]);let p=async(e,t,r)=>{let a=(0,n.createClient)();if(!a)return{error:{message:"Service d'authentification non disponible"}};let{error:s}=await a.auth.signUp({email:e,password:t,options:{data:r}});return{error:s}},x=async(e,t)=>{let r=(0,n.createClient)();if(!r)return{error:{message:"Service d'authentification non disponible"}};let{error:a}=await r.auth.signInWithPassword({email:e,password:t});return m.refresh(),{error:a}},f=async()=>{let e=(0,n.createClient)();e&&(await e.auth.signOut(),m.refresh())},D=async e=>{let t=(0,n.createClient)();if(!t)return{error:{message:"Service d'authentification non disponible"}};let{error:r}=await t.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});return{error:r}},S=async e=>{let t=(0,n.createClient)();if(!t)return{exists:!1,error:{message:"Service d'authentification non disponible"}};try{var r,a;let{error:s}=await t.auth.signInWithPassword({email:e,password:"dummy-password-for-check-only"});if(null==s||null==(r=s.message)?void 0:r.includes("Invalid login credentials"))return{exists:!1,error:null};if(null==s||null==(a=s.message)?void 0:a.includes("Invalid password"))return{exists:!0,error:null};return{exists:!1,error:s}}catch(e){return{exists:!1,error:e}}},b=async(e,t)=>{let r=(0,n.createClient)();if(!r)return{error:{message:"Service d'authentification non disponible"}};let{error:a}=await r.auth.setSession({access_token:e,refresh_token:t});return a||m.refresh(),{error:a}};return(0,a.jsx)(l.Provider,{value:{user:r,session:c,loading:d,signUp:p,signIn:x,signOut:f,resetPassword:D,checkEmailExists:S,confirmEmail:b},children:t})}function c(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9981:(e,t,r)=>{"use strict";r.d(t,{a:()=>s});let a="flocon_orders";class s{static getUserOrders(e){let t=localStorage.getItem(a);return(t?JSON.parse(t):[]).filter(t=>t.userId===e)}static addOrder(e){let t={...e,id:"CMD-".concat(Date.now()),date:new Date().toISOString()},r=localStorage.getItem(a),s=r?JSON.parse(r):[];return s.push(t),localStorage.setItem(a,JSON.stringify(s)),this.updateUserStats(e.userId,t),t}static removeDuplicateOrders(e){let t=localStorage.getItem(a),r=t?JSON.parse(t):[],s=r.filter(t=>t.userId===e),n=new Map;s.forEach(e=>{let t="".concat(e.total,"-").concat(e.items);n.has(t)||n.set(t,[]),n.get(t).push(e)});let i=0;return n.forEach((e,t)=>{if(e.length>1){e.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),e[0];let t=e.slice(1),s=r.filter(e=>!t.some(t=>t.id===e.id));localStorage.setItem(a,JSON.stringify(s)),i+=t.length}}),i}static updateOrderStatus(e,t){let r=localStorage.getItem(a),s=r?JSON.parse(r):[],n=s.findIndex(t=>t.id===e);return -1!==n&&(s[n].status=t,localStorage.setItem(a,JSON.stringify(s)),!0)}static getUserStats(e){let t=this.getUserOrders(e),r=t.length,a=t.reduce((e,t)=>e+t.total,0),s=Math.floor(a/10),n={};return t.forEach(e=>{e.products.forEach(e=>{let t="Saint-Valentin";n[t]=(n[t]||0)+1})}),{totalOrders:r,totalSpent:a,favoriteCategory:Object.keys(n).reduce((e,t)=>n[e]>n[t]?e:t,"Saint-Valentin"),memberSince:"D\xe9cembre 2025",loyaltyPoints:s,nextReward:s>=500?"R\xe9duction de -50€ disponible !":"-50€ sur prochaine commande (".concat(500-s," points)")}}static updateUserStats(e,t){let r=this.getUserStats(e);localStorage.setItem("".concat("flocon_user_stats","_").concat(e),JSON.stringify(r))}static createOrderFromCart(e,t,r){let a=t.map(e=>({id:e.id,name:e.name,price:e.price,quantity:e.quantity,image:e.images[0]})),s=t.reduce((e,t)=>e+t.price*t.quantity,0),n=t.reduce((e,t)=>e+t.quantity,0);return this.addOrder({userId:e,status:"En attente",total:s,items:n,products:a,shippingAddress:r})}}}},e=>{e.O(0,[8096,7358],()=>e(e.s=1796)),_N_E=e.O()}]);