(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4003,8525],{999:(e,t,r)=>{"use strict";r.d(t,{LF:()=>a,Ow:()=>i,fW:()=>n});var s=r(9981);function a(e,t){try{let r=s.a.getUserOrders(t).find(t=>t.id.includes(e.sessionId)||t.total===e.total&&t.items===e.items&&6e5>Math.abs(new Date(t.date).getTime()-Date.now()));if(r){let t=JSON.parse(localStorage.getItem("flocon_orders")||"[]"),s=t.findIndex(e=>e.id===r.id);if(-1!==s)return t[s].status="Livr\xe9",t[s].shippingAddress=e.shippingAddress,localStorage.setItem("flocon_orders",JSON.stringify(t)),t[s]}return null}catch(e){return null}}function i(e){try{let t=localStorage.getItem("flocon_orders");if(!t)return 0;let r=JSON.parse(t),s=r.filter(t=>t.userId===e).filter(e=>"En pr\xe9paration"===e.status||e.shippingAddress&&e.shippingAddress.address&&e.shippingAddress.address.includes("En attente")),a=0;return s.forEach(e=>{let t=r.findIndex(t=>t.id===e.id);if(-1!==t){var s,i;let n=localStorage.getItem("checkout-shipping-address"),l={name:(null==(s=e.shippingAddress)?void 0:s.name)||"Client",address:"Adresse synchronis\xe9e manuellement",city:"Ville synchronis\xe9e",postalCode:"00000",phone:"T\xe9l\xe9phone synchronis\xe9"};if(n)try{let t=JSON.parse(n);l={name:t.name||(null==(i=e.shippingAddress)?void 0:i.name)||"Client",address:t.address||"Adresse confirm\xe9e",city:t.city||"Ville confirm\xe9e",postalCode:t.postalCode||"00000",phone:t.phone||"T\xe9l\xe9phone confirm\xe9"}}catch(e){}r[t].status="Livr\xe9",r[t].shippingAddress=l,r[t].date=new Date().toISOString(),a++}}),a>0&&localStorage.setItem("flocon_orders",JSON.stringify(r)),a}catch(e){return 0}}function n(e,t){try{let r=JSON.parse(localStorage.getItem("flocon_orders")||"[]"),s=r.findIndex(t=>t.id===e);if(-1!==s)return r[s].status="Livr\xe9",r[s].shippingAddress=t,localStorage.setItem("flocon_orders",JSON.stringify(r)),!0;return!1}catch(e){return!1}}},6891:(e,t,r)=>{Promise.resolve().then(r.bind(r,7627))},7627:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var s=r(5155),a=r(63),i=r(2115),n=r(8382),l=r(1078),o=r(5917),c=r(952),d=r(2619),m=r.n(d),u=r(9730),h=r(9981),p=r(999),f=r(9962),x=r(7127),g=r.n(x);function y(){return(0,i.useEffect)(()=>{{let e="2024-01-01-v2";sessionStorage.getItem("checkout-success-version")!==e&&(sessionStorage.setItem("checkout-success-version",e),window.location.reload())}},[]),(0,s.jsxs)(g(),{children:[(0,s.jsx)("meta",{name:"cache-control",content:"no-cache, no-store, must-revalidate"}),(0,s.jsx)("meta",{name:"pragma",content:"no-cache"}),(0,s.jsx)("meta",{name:"expires",content:"0"})]})}function b(){var e;let t=(0,a.useSearchParams)(),r=(0,a.useRouter)(),{user:d,loading:x}=(0,u.A)(),{clearCart:g}=(0,f._)(),y=t.get("session_id"),[b,v]=(0,i.useState)(!0),[j,N]=(0,i.useState)(null);return((0,i.useEffect)(()=>{g();try{localStorage.removeItem("cart-cleared-notification"),localStorage.removeItem("checkout-cart-cleared")}catch(e){}if(!y){let e=setTimeout(()=>{r.push("/checkout")},3e3);return()=>clearTimeout(e)}x||(async()=>{try{let e=await fetch("/api/get-session?session_id=".concat(y)),t=await e.json();if(e.ok&&t.orderDetails){if(N(t.orderDetails),d&&t.orderDetails.items){if(h.a.getUserOrders(d.id).find(e=>e.id.includes(y)||e.total===t.orderDetails.total&&e.items===t.orderDetails.items.reduce((e,t)=>e+t.quantity,0)&&3e5>Math.abs(new Date(e.date).getTime()-Date.now())))return;let e=t.orderDetails.items.map(e=>({id:e.id||"unknown",name:e.name,price:e.price,quantity:e.quantity,image:e.image||"/logof.jpg"}));try{h.a.addOrder({userId:d.id,status:"En pr\xe9paration",total:t.orderDetails.total,items:t.orderDetails.items.reduce((e,t)=>e+t.quantity,0),products:e,shippingAddress:{name:t.orderDetails.email||"Client",address:"En attente de confirmation webhook",city:"En attente de confirmation webhook",postalCode:"00000",phone:"En attente de confirmation webhook"}});let r=localStorage.getItem("checkout-shipping-address");if(r)try{let e=JSON.parse(r);(0,p.LF)({sessionId:y,customerEmail:t.orderDetails.email||d.email||"",total:t.orderDetails.total,items:t.orderDetails.items.reduce((e,t)=>e+t.quantity,0),shippingAddress:{name:e.name||t.orderDetails.email||"Client",address:e.address||"Adresse confirm\xe9e",city:e.city||"Ville confirm\xe9e",postalCode:e.postalCode||"00000",phone:e.phone||"T\xe9l\xe9phone confirm\xe9",country:e.country||"FR"}},d.id)}catch(e){}}catch(e){}}}else N({id:y,status:"Pay\xe9e",email:"Non disponible",total:0})}catch(e){N({id:y,status:"Pay\xe9e",email:"Non disponible",total:0})}finally{v(!1)}})()},[y,d,x,r]),b&&!y)?(0,s.jsx)("div",{className:"pt-28 min-h-screen bg-gradient-to-br from-orange-50 to-amber-50 flex items-center justify-center px-4",children:(0,s.jsxs)("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)(l.A,{className:"w-8 h-8 text-orange-600"})}),(0,s.jsx)("h1",{className:"text-2xl font-display font-bold text-textDark mb-4",children:"Acc\xe8s non valide"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"Cette page n'est accessible qu'apr\xe8s un paiement r\xe9ussi."}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-6",children:"Vous serez redirig\xe9 vers la page de paiement dans 3 secondes..."}),(0,s.jsx)(m(),{href:"/checkout",className:"inline-block bg-rose-custom text-white px-6 py-3 rounded-xl font-semibold hover:bg-rose-custom/90 transition-colors",children:"Retour au paiement"})]})}):b?(0,s.jsx)("div",{className:"pt-28 min-h-screen bg-cream flex items-center justify-center px-4",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 border-4 border-rose-custom border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Chargement des d\xe9tails de votre commande..."})]})}):(0,s.jsx)("div",{className:"pt-28 min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center px-4",children:(0,s.jsx)("div",{className:"max-w-2xl w-full",children:(0,s.jsxs)(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl shadow-xl p-8 text-center",children:[(0,s.jsx)(n.P.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"w-24 h-24 bg-black rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl border-4 border-black",children:(0,s.jsx)(o.A,{className:"w-12 h-12 text-white",strokeWidth:3})}),(0,s.jsx)(n.P.h1,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"text-4xl font-display font-black text-textDark mb-4",children:"Paiement r\xe9ussi !"}),(0,s.jsx)(n.P.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"text-lg text-gray-600 mb-8",children:"Merci pour votre commande. Vous recevrez un email de confirmation sous peu avec les d\xe9tails de livraison."}),(0,s.jsxs)(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-gray-50 rounded-xl p-6 mb-8 text-left",children:[(0,s.jsxs)("h2",{className:"font-semibold text-textDark mb-4 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-rose-custom rounded-full"}),"D\xe9tails de la commande"]}),(0,s.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsx)("span",{className:"text-gray-600 flex-shrink-0",children:"Num\xe9ro de commande:"}),(0,s.jsxs)("div",{className:"text-right ml-2",children:[(0,s.jsx)("span",{className:"font-mono font-medium text-rose-custom block",children:(null==j?void 0:j.id)?"CMD-".concat(j.id.substring(0,8).toUpperCase()):"N/A"}),(0,s.jsx)("span",{className:"text-xs text-gray-500 block font-mono",style:{wordBreak:"break-all",maxWidth:"200px"},children:null==j?void 0:j.id})]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-t border-gray-200",children:[(0,s.jsxs)("span",{className:"text-gray-600 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Statut:"]}),(0,s.jsx)("span",{className:"font-medium text-green-600",children:null==j?void 0:j.status})]}),(0,s.jsxs)("div",{className:"flex justify-between items-start py-2 border-t border-gray-200",children:[(0,s.jsx)("span",{className:"text-gray-600 flex-shrink-0",children:"Email de confirmation:"}),(0,s.jsx)("span",{className:"font-medium text-right break-all ml-2 text-blue-600",style:{wordBreak:"break-all",maxWidth:"200px"},children:null==j?void 0:j.email})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-t border-gray-200",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Total:"}),(0,s.jsxs)("span",{className:"font-bold text-xl text-rose-custom",children:[null==j||null==(e=j.total)?void 0:e.toFixed(2)," €"]})]}),(null==j?void 0:j.items)&&j.items.length>0&&(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,s.jsx)("p",{className:"text-gray-600 mb-3 font-medium",children:"Articles command\xe9s:"}),(0,s.jsx)("div",{className:"space-y-2 bg-white rounded-lg p-3",children:j.items.map((e,t)=>(0,s.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,s.jsxs)("div",{className:"flex-1 mr-2",children:[(0,s.jsx)("span",{className:"font-medium text-textDark",children:e.name}),(0,s.jsxs)("span",{className:"text-gray-500 ml-2",children:["\xd7",e.quantity]})]}),(0,s.jsxs)("span",{className:"font-semibold text-rose-custom flex-shrink-0",children:[e.price.toFixed(2)," €"]})]},t))})]})]})]}),(0,s.jsxs)(n.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"flex flex-col sm:flex-row gap-4",children:[(0,s.jsxs)(m(),{href:"/dashboard",className:"flex-1 bg-black text-white px-6 py-4 rounded-xl font-semibold hover:bg-gray-800 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2 border-2 border-black",children:[(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),(0,s.jsx)("span",{children:"Voir mes commandes"})]}),(0,s.jsxs)(m(),{href:"/boutique",className:"flex-1 bg-white border-2 border-black text-black px-6 py-4 rounded-xl font-semibold hover:bg-gray-50 hover:border-gray-800 transition-all duration-200 flex items-center justify-center gap-2",children:[(0,s.jsx)(c.A,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"Continuer mes achats"})]})]}),(0,s.jsx)(n.P.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.7},className:"text-sm text-gray-500 mt-6",children:"Un email de confirmation a \xe9t\xe9 envoy\xe9 \xe0 votre adresse email."})]})})})}function v(){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y,{}),(0,s.jsx)(i.Suspense,{fallback:(0,s.jsx)("div",{className:"pt-28 min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center px-4",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 border-4 border-rose-custom border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Chargement..."})]})}),children:(0,s.jsx)(b,{})})]})}},8525:(e,t,r)=>{"use strict";r.d(t,{createClient:()=>a});var s=r(5417);function a(){let e="https://xvczqjkmbfpjkdghvomc.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh2Y3pxamttYmZwamtkZ2h2b21jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0MjA5MjUsImV4cCI6MjA4NDk5NjkyNX0.Qi9gHILEaBylF8ObdcpXqg9n8wrlX46MFSzlIcZbCG0";return e&&t?(0,s.createBrowserClient)(e,t):null}},9730:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,AuthProvider:()=>o});var s=r(5155),a=r(2115),i=r(8525),n=r(63);let l=(0,a.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),[m,u]=(0,a.useState)(!0),h=(0,n.useRouter)(),p=(0,i.createClient)();(0,a.useEffect)(()=>{if(!p)return void u(!1);let{data:{subscription:e}}=p.auth.onAuthStateChange((e,t)=>{var r;d(t),o(null!=(r=null==t?void 0:t.user)?r:null),u(!1)});return(async()=>{var e;let{data:{session:t}}=await p.auth.getSession();d(t),o(null!=(e=null==t?void 0:t.user)?e:null),u(!1)})(),()=>{e.unsubscribe()}},[p,h]);let f=async(e,t,r)=>{let s=(0,i.createClient)();if(!s)return{error:{message:"Service d'authentification non disponible"}};let{error:a}=await s.auth.signUp({email:e,password:t,options:{data:r}});return{error:a}},x=async(e,t)=>{let r=(0,i.createClient)();if(!r)return{error:{message:"Service d'authentification non disponible"}};let{error:s}=await r.auth.signInWithPassword({email:e,password:t});return h.refresh(),{error:s}},g=async()=>{let e=(0,i.createClient)();e&&(await e.auth.signOut(),h.refresh())},y=async e=>{let t=(0,i.createClient)();if(!t)return{error:{message:"Service d'authentification non disponible"}};let{error:r}=await t.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});return{error:r}},b=async e=>{let t=(0,i.createClient)();if(!t)return{exists:!1,error:{message:"Service d'authentification non disponible"}};try{var r,s;let{error:a}=await t.auth.signInWithPassword({email:e,password:"dummy-password-for-check-only"});if(null==a||null==(r=a.message)?void 0:r.includes("Invalid login credentials"))return{exists:!1,error:null};if(null==a||null==(s=a.message)?void 0:s.includes("Invalid password"))return{exists:!0,error:null};return{exists:!1,error:a}}catch(e){return{exists:!1,error:e}}},v=async(e,t)=>{let r=(0,i.createClient)();if(!r)return{error:{message:"Service d'authentification non disponible"}};let{error:s}=await r.auth.setSession({access_token:e,refresh_token:t});return s||h.refresh(),{error:s}};return(0,s.jsx)(l.Provider,{value:{user:r,session:c,loading:m,signUp:f,signIn:x,signOut:g,resetPassword:y,checkEmailExists:b,confirmEmail:v},children:t})}function c(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9962:(e,t,r)=>{"use strict";r.d(t,{_:()=>o,e:()=>l});var s=r(5155),a=r(2115);let i=(0,a.createContext)(void 0),n="flocon-cart";function l(e){let{children:t}=e,[r,l]=(0,a.useState)([]),[o,c]=(0,a.useState)(!1);(0,a.useEffect)(()=>{try{let e=localStorage.getItem(n);if(e){let t=JSON.parse(e);l(Array.isArray(t)?t:[])}}catch(e){localStorage.removeItem(n)}finally{c(!0)}},[]),(0,a.useEffect)(()=>{if(o)try{localStorage.setItem(n,JSON.stringify(r))}catch(e){}},[r,o]);let d=e=>{l(t=>t.filter(t=>t.id!==e))};return(0,s.jsx)(i.Provider,{value:{cartItems:r,addToCart:e=>{l(t=>t.find(t=>t.id===e.id)?t.map(t=>t.id===e.id?{...t,quantity:t.quantity+1}:t):[...t,{...e,quantity:1}])},removeFromCart:d,updateQuantity:(e,t)=>{if(t<=0)return void d(e);l(r=>r.map(r=>r.id===e?{...r,quantity:t}:r))},clearCart:()=>{l([]);try{localStorage.removeItem(n)}catch(e){}},clearCartAfterPayment:()=>{l([]);try{localStorage.removeItem(n),localStorage.setItem("last-payment",new Date().toISOString())}catch(e){}}},children:t})}function o(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}},9981:(e,t,r)=>{"use strict";r.d(t,{a:()=>a});let s="flocon_orders";class a{static getUserOrders(e){let t=localStorage.getItem(s);return(t?JSON.parse(t):[]).filter(t=>t.userId===e)}static addOrder(e){let t={...e,id:"CMD-".concat(Date.now()),date:new Date().toISOString()},r=localStorage.getItem(s),a=r?JSON.parse(r):[];return a.push(t),localStorage.setItem(s,JSON.stringify(a)),this.updateUserStats(e.userId,t),t}static removeDuplicateOrders(e){let t=localStorage.getItem(s),r=t?JSON.parse(t):[],a=r.filter(t=>t.userId===e),i=new Map;a.forEach(e=>{let t="".concat(e.total,"-").concat(e.items);i.has(t)||i.set(t,[]),i.get(t).push(e)});let n=0;return i.forEach((e,t)=>{if(e.length>1){e.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),e[0];let t=e.slice(1),a=r.filter(e=>!t.some(t=>t.id===e.id));localStorage.setItem(s,JSON.stringify(a)),n+=t.length}}),n}static updateOrderStatus(e,t){let r=localStorage.getItem(s),a=r?JSON.parse(r):[],i=a.findIndex(t=>t.id===e);return -1!==i&&(a[i].status=t,localStorage.setItem(s,JSON.stringify(a)),!0)}static getUserStats(e){let t=this.getUserOrders(e),r=t.length,s=t.reduce((e,t)=>e+t.total,0),a=Math.floor(s/10),i={};return t.forEach(e=>{e.products.forEach(e=>{let t="Saint-Valentin";i[t]=(i[t]||0)+1})}),{totalOrders:r,totalSpent:s,favoriteCategory:Object.keys(i).reduce((e,t)=>i[e]>i[t]?e:t,"Saint-Valentin"),memberSince:"D\xe9cembre 2025",loyaltyPoints:a,nextReward:a>=500?"R\xe9duction de -50€ disponible !":"-50€ sur prochaine commande (".concat(500-a," points)")}}static updateUserStats(e,t){let r=this.getUserStats(e);localStorage.setItem("".concat("flocon_user_stats","_").concat(e),JSON.stringify(r))}static createOrderFromCart(e,t,r){let s=t.map(e=>({id:e.id,name:e.name,price:e.price,quantity:e.quantity,image:e.images[0]})),a=t.reduce((e,t)=>e+t.price*t.quantity,0),i=t.reduce((e,t)=>e+t.quantity,0);return this.addOrder({userId:e,status:"En attente",total:a,items:i,products:s,shippingAddress:r})}}}},e=>{e.O(0,[8096,7358],()=>e(e.s=6891)),_N_E=e.O()}]);