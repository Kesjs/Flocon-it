"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7141],{7141:(e,s,t)=>{t.d(s,{A:()=>g});var r=t(5155),a=t(2115),n=t(6497),l=t(8382),i=t(5229),o=t(5917),d=t(8519),c=t(9962),u=t(9730),m=t(5681),p=t(4511),h=t(3856),x=t(4389);function g(e){let{isOpen:s,onClose:t}=e,{cartItems:p,clearCart:g}=(0,c._)(),{user:b}=(0,u.A)(),[f,y]=(0,a.useState)(!1),[j,v]=(0,a.useState)(!1),[N,w]=(0,a.useState)(""),[C,k]=(0,a.useState)(!1),[A,P]=(0,a.useState)([]),[q,D]=(0,a.useState)(""),[E,S]=(0,a.useState)({name:"",address:"",city:"",postalCode:"",phone:""}),T=p.reduce((e,s)=>e+s.price*s.quantity,0),F=()=>{let e=[];return(0,h.B9)(N)||e.push("Email invalide : format attendu exemple@domaine.com"),(0,h.uV)(E.name)||e.push("Nom complet invalide : 2-100 caract\xe8res, lettres uniquement"),(0,h.$m)(E.address)||e.push("Adresse invalide : 5-200 caract\xe8res requis"),(0,h.Wd)(E.city)||e.push("Ville invalide : 2-100 caract\xe8res, lettres uniquement"),(0,h.Zj)(E.postalCode)||e.push("Code postal invalide : 5 chiffres requis (ex: 75001)"),(0,h.BH)(E.phone)||e.push("T\xe9l\xe9phone invalide : format fran\xe7ais requis (ex: +33 6 12 34 56 78)"),P(e),0===e.length};(0,a.useEffect)(()=>{if(s&&(null==b?void 0:b.email)&&w(b.email),s){let e=x.a.getIntent();(null==e?void 0:e.type)==="checkout"&&e.data&&(e.data.email&&!N&&w(e.data.email),e.data.shippingAddress&&S(s=>({...s,...e.data.shippingAddress})),x.a.clearIntent())}},[s,b,N]);let I=async()=>{if(0!==p.length&&F()){if(!b){x.a.setCheckoutIntent({email:N,shippingAddress:E}),alert("Veuillez vous connecter pour finaliser votre commande");return}y(!0);try{let e=await fetch("/api/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cartItems:p,customerEmail:N,metadata:{userId:b.id,shippingName:E.name||N,shippingAddress:E.address||"Adresse non sp\xe9cifi\xe9e",shippingCity:E.city||"Paris",shippingPostalCode:E.postalCode||"75001",shippingPhone:E.phone||"+33 6 00 00 00 00"},shippingAddress:E})});if(!e.ok){let s=await e.text();throw Error("Erreur API: ".concat(e.status," - ").concat(s))}let{url:s}=await e.json();if(s)t(),window.location.href=s;else throw Error("URL de paiement non re\xe7ue")}catch(e){alert("Une erreur est survenue lors du paiement. Veuillez r\xe9essayer."),y(!1)}}},V=async()=>{if(0!==p.length&&F()){if(!b){x.a.setCheckoutIntent({email:N,shippingAddress:E}),alert("Veuillez vous connecter pour finaliser votre commande");return}y(!0);try{let e=await m._.processPayment(b.id,p,E,"card");e.success?(g(),D("\uD83C\uDF89 ".concat(e.message,"\nNum\xe9ro de commande: ").concat(e.orderId)),v(!0),setTimeout(()=>{t(),window.location.href="/dashboard"},3e3)):P([e.message])}catch(e){alert("Une erreur est survenue lors du traitement du paiement. Veuillez r\xe9essayer.")}finally{y(!1)}}};return s?(0,r.jsx)(n.N,{children:(0,r.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:t,children:(0,r.jsxs)(l.P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",damping:30,stiffness:300},className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"sticky top-0 bg-white border-b p-6 flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-2xl font-display font-bold text-textDark",children:"Finaliser ma commande"}),(0,r.jsx)("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(i.A,{className:"w-5 h-5"})})]}),(0,r.jsx)("div",{className:"p-6",children:j?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)(o.A,{className:"w-8 h-8 text-green-600"})}),(0,r.jsx)("h3",{className:"text-2xl font-bold text-textDark mb-2",children:"Commande confirm\xe9e !"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"Merci pour votre achat. Redirection vers votre dashboard..."})]}):C?(0,r.jsx)("div",{children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("p",{children:"R\xe9sum\xe9 de la commande..."})})}):(0,r.jsxs)("div",{className:"space-y-6",children:[q&&(0,r.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,r.jsx)("h4",{className:"font-semibold text-green-800 mb-2",children:"\uD83C\uDF89 Paiement r\xe9ussi !"}),(0,r.jsx)("p",{className:"text-green-700 text-sm whitespace-pre-line",children:q}),(0,r.jsx)("p",{className:"text-green-600 text-xs mt-2",children:"Redirection vers votre dashboard..."})]}),A.length>0&&(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,r.jsx)("h4",{className:"font-semibold text-red-800 mb-2",children:"Erreurs de validation :"}),(0,r.jsx)("ul",{className:"space-y-1",children:A.map((e,s)=>(0,r.jsxs)("li",{className:"text-red-700 text-sm",children:["• ",e]},s))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-textDark mb-2",children:"Email pour la confirmation"}),(0,r.jsx)("input",{type:"email",value:N,onChange:e=>w(e.target.value),placeholder:"votre@email.com",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose focus:border-transparent outline-none",required:!0})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"font-semibold text-textDark mb-3",children:"Adresse de livraison"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nom complet"}),(0,r.jsx)("input",{type:"text",value:E.name,onChange:e=>S({...E,name:e.target.value}),placeholder:"Jean Dupont",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose focus:border-transparent outline-none",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"T\xe9l\xe9phone"}),(0,r.jsx)("input",{type:"tel",value:E.phone,onChange:e=>S({...E,phone:e.target.value}),placeholder:"+33 6 12 34 56 78",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose focus:border-transparent outline-none",required:!0})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Adresse"}),(0,r.jsx)("input",{type:"text",value:E.address,onChange:e=>S({...E,address:e.target.value}),placeholder:"123 Rue de la Paix",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose focus:border-transparent outline-none",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ville"}),(0,r.jsx)("input",{type:"text",value:E.city,onChange:e=>S({...E,city:e.target.value}),placeholder:"Paris",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose focus:border-transparent outline-none",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Code postal"}),(0,r.jsx)("input",{type:"text",value:E.postalCode,onChange:e=>S({...E,postalCode:e.target.value}),placeholder:"75001",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose focus:border-transparent outline-none",required:!0})]})]})]}),(0,r.jsx)("div",{className:"border-t pt-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsxs)("span",{className:"text-lg font-semibold",children:["Total (",p.length," article",p.length>1?"s":"",")"]}),(0,r.jsxs)("span",{className:"text-2xl font-bold text-rose-custom",children:[T.toFixed(2)," €"]})]})}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("button",{onClick:I,disabled:f,className:"w-full bg-rose-custom text-white py-3 rounded-lg font-semibold hover:bg-rose-custom/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:f?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Paiement en cours..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.A,{className:"w-5 h-5"}),"Payer avec Stripe"]})}),(0,r.jsx)("button",{onClick:V,disabled:f,className:"w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:f?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Traitement en cours..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.A,{className:"w-5 h-5"}),"Payer (Mode Test)"]})})]})]})})]})})}):null}(0,p.c)("pk_test_51StI7DGZaaEE3nqfEwTdXZCv2SlFfVzt89t8K4erydDn3U06yNBYtfyCG0VINzkTDHw3kjdsbJYO6qv53ntD2uLO00KKHgZnbj")}}]);