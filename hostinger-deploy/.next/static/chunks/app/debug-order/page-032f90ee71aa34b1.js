(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8525,9767],{455:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var a=r(5155),s=r(2115),n=r(63),i=r(9730),c=r(9981);function l(){let{user:e}=(0,i.A)(),t=(0,n.useRouter)(),[r,l]=(0,s.useState)(""),[o,d]=(0,s.useState)([]),[u,m]=(0,s.useState)([]);(0,s.useEffect)(()=>{h()},[e]);let h=()=>{let t="\uD83D\uDD0D DEBUG COMMANDE MANQUANTE\n";t+="===========================\n\n",t+="\uD83D\uDC64 UTILISATEUR:\n",t+="• Connect\xe9: ".concat(e?"✅ Oui":"❌ Non","\n"),t+="• ID: ".concat((null==e?void 0:e.id)||"N/A","\n"),t+="• Email: ".concat((null==e?void 0:e.email)||"N/A","\n\n"),t+="\uD83D\uDCBE LOCALSTORAGE:\n";let r=localStorage.getItem("flocon_orders");if(r)try{let e=JSON.parse(r);t+="• Commandes brutes: ".concat(Array.isArray(e)?e.length:"N/A","\n"),Array.isArray(e)&&e.forEach((e,r)=>{t+="  ".concat(r+1,". ID: ").concat(e.id,", User: ").concat(e.userId,", Status: ").concat(e.status,"\n")})}catch(e){t+="❌ Erreur parsing: ".concat(e,"\n")}else t+="• Aucune donn\xe9e trouv\xe9e\n";if(t+="\n\uD83D\uDCE6 ORDERSTORAGE:\n",e)try{let r=c.a.getUserOrders(e.id);t+="• Commandes utilisateur: ".concat(r.length,"\n"),r.forEach((e,r)=>{t+="  ".concat(r+1,". ").concat(e.id," - ").concat(e.status," - ").concat(e.total,"€\n")}),m(r)}catch(e){t+="❌ Erreur OrderStorage: ".concat(e,"\n")}if(t+="\n\uD83D\uDD0D V\xc9RIFICATION USER ID:\n",r)try{let a=JSON.parse(r),s=a.filter(t=>t.userId!==(null==e?void 0:e.id));t+="• Commandes autres users: ".concat(s.length,"\n"),s.length>0&&(t+="• User ID actuel: ".concat(null==e?void 0:e.id,"\n"),t+="• User IDs trouv\xe9s: ".concat([...new Set(a.map(e=>e.userId))].join(", "),"\n")),d(a)}catch(e){t+="❌ Erreur v\xe9rification: ".concat(e,"\n")}t+="\n\uD83D\uDED2 PANIER ACTUEL:\n";let a=localStorage.getItem("flocon-cart");if(a)try{let e=JSON.parse(a);t+="• Articles dans panier: ".concat(e.items?e.items.length:0,"\n"),e.items&&e.items.forEach((e,r)=>{t+="  ".concat(r+1,". ").concat(e.name," - ").concat(e.price,"€ x").concat(e.quantity,"\n")})}catch(e){t+="❌ Erreur panier: ".concat(e,"\n")}else t+="• Panier vide\n";l(t)};return(0,a.jsx)("div",{className:"pt-28 min-h-screen bg-cream px-4 py-12",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-textDark mb-2",children:"\uD83D\uDD0D Debug Commande Manquante"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Diagnostic complet pour trouver pourquoi votre commande n'appara\xeet pas"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"\uD83D\uDCCB R\xe9sultats du diagnostic"}),(0,a.jsx)("pre",{className:"text-xs bg-gray-50 p-4 rounded-lg overflow-auto max-h-96",children:r})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"\uD83D\uDCE6 Toutes les commandes"}),(0,a.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:o.map((t,r)=>(0,a.jsx)("div",{className:"border-b pb-2",children:(0,a.jsxs)("div",{className:"font-mono text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"font-medium",children:t.id}),(0,a.jsx)("span",{className:t.userId===(null==e?void 0:e.id)?"text-green-600":"text-red-600",children:t.userId===(null==e?void 0:e.id)?"✅":"❌"})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:["User: ",t.userId.slice(0,8),"... • ",t.status," • ",t.total,"€"]})]})},r))})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"\uD83D\uDC64 Vos commandes"}),(0,a.jsxs)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[u.map((e,t)=>(0,a.jsx)("div",{className:"border-b pb-2",children:(0,a.jsxs)("div",{className:"font-mono text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"font-medium",children:e.id}),(0,a.jsx)("span",{className:"text-green-600",children:"✅"})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:[e.status," • ",e.total,"€ • ",e.items," articles"]})]})},t)),0===u.length&&(0,a.jsx)("p",{className:"text-gray-500 text-center py-4",children:"Aucune commande trouv\xe9e"})]})]})]}),(0,a.jsxs)("div",{className:"mt-8 flex gap-4 flex-wrap",children:[(0,a.jsx)("button",{onClick:h,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"\uD83D\uDD04 Relancer diagnostic"}),(0,a.jsx)("button",{onClick:()=>{if(!e)return void alert("Utilisateur non connect\xe9");try{let t=c.a.addOrder({userId:e.id,status:"Livr\xe9",total:99.99,items:1,products:[{id:"test-1",name:"Produit Test",price:99.99,quantity:1,image:"/logof.jpg"}],shippingAddress:{name:"Test User",address:"123 Test Street",city:"Paris",postalCode:"75001",phone:"+33 6 00 00 00 00"}});alert("✅ Commande test cr\xe9\xe9e: ".concat(t.id)),h()}catch(e){alert("❌ Erreur: ".concat(e))}},className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"\uD83E\uDDEA Cr\xe9er commande test"}),(0,a.jsx)("button",{onClick:()=>t.push("/dashboard"),className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"\uD83C\uDFE0 Dashboard"}),(0,a.jsx)("button",{onClick:()=>t.push("/clean-data"),className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"\uD83E\uDDF9 Nettoyer tout"})]})]})})}},3629:(e,t,r)=>{Promise.resolve().then(r.bind(r,455))},8525:(e,t,r)=>{"use strict";r.d(t,{createClient:()=>s});var a=r(5417);function s(){let e="https://xvczqjkmbfpjkdghvomc.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh2Y3pxamttYmZwamtkZ2h2b21jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0MjA5MjUsImV4cCI6MjA4NDk5NjkyNX0.Qi9gHILEaBylF8ObdcpXqg9n8wrlX46MFSzlIcZbCG0";return e&&t?(0,a.createBrowserClient)(e,t):null}},9730:(e,t,r)=>{"use strict";r.d(t,{A:()=>o,AuthProvider:()=>l});var a=r(5155),s=r(2115),n=r(8525),i=r(63);let c=(0,s.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,s.useState)(null),[o,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(!0),h=(0,i.useRouter)(),g=(0,n.createClient)();(0,s.useEffect)(()=>{if(!g)return void m(!1);let{data:{subscription:e}}=g.auth.onAuthStateChange((e,t)=>{var r;d(t),l(null!=(r=null==t?void 0:t.user)?r:null),m(!1)});return(async()=>{var e;let{data:{session:t}}=await g.auth.getSession();d(t),l(null!=(e=null==t?void 0:t.user)?e:null),m(!1)})(),()=>{e.unsubscribe()}},[g,h]);let p=async(e,t,r)=>{let a=(0,n.createClient)();if(!a)return{error:{message:"Service d'authentification non disponible"}};let{error:s}=await a.auth.signUp({email:e,password:t,options:{data:r}});return{error:s}},x=async(e,t)=>{let r=(0,n.createClient)();if(!r)return{error:{message:"Service d'authentification non disponible"}};let{error:a}=await r.auth.signInWithPassword({email:e,password:t});return h.refresh(),{error:a}},f=async()=>{let e=(0,n.createClient)();e&&(await e.auth.signOut(),h.refresh())},v=async e=>{let t=(0,n.createClient)();if(!t)return{error:{message:"Service d'authentification non disponible"}};let{error:r}=await t.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});return{error:r}},D=async e=>{let t=(0,n.createClient)();if(!t)return{exists:!1,error:{message:"Service d'authentification non disponible"}};try{var r,a;let{error:s}=await t.auth.signInWithPassword({email:e,password:"dummy-password-for-check-only"});if(null==s||null==(r=s.message)?void 0:r.includes("Invalid login credentials"))return{exists:!1,error:null};if(null==s||null==(a=s.message)?void 0:a.includes("Invalid password"))return{exists:!0,error:null};return{exists:!1,error:s}}catch(e){return{exists:!1,error:e}}},b=async(e,t)=>{let r=(0,n.createClient)();if(!r)return{error:{message:"Service d'authentification non disponible"}};let{error:a}=await r.auth.setSession({access_token:e,refresh_token:t});return a||h.refresh(),{error:a}};return(0,a.jsx)(c.Provider,{value:{user:r,session:o,loading:u,signUp:p,signIn:x,signOut:f,resetPassword:v,checkEmailExists:D,confirmEmail:b},children:t})}function o(){let e=(0,s.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9981:(e,t,r)=>{"use strict";r.d(t,{a:()=>s});let a="flocon_orders";class s{static getUserOrders(e){let t=localStorage.getItem(a);return(t?JSON.parse(t):[]).filter(t=>t.userId===e)}static addOrder(e){let t={...e,id:"CMD-".concat(Date.now()),date:new Date().toISOString()},r=localStorage.getItem(a),s=r?JSON.parse(r):[];return s.push(t),localStorage.setItem(a,JSON.stringify(s)),this.updateUserStats(e.userId,t),t}static removeDuplicateOrders(e){let t=localStorage.getItem(a),r=t?JSON.parse(t):[],s=r.filter(t=>t.userId===e),n=new Map;s.forEach(e=>{let t="".concat(e.total,"-").concat(e.items);n.has(t)||n.set(t,[]),n.get(t).push(e)});let i=0;return n.forEach((e,t)=>{if(e.length>1){e.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),e[0];let t=e.slice(1),s=r.filter(e=>!t.some(t=>t.id===e.id));localStorage.setItem(a,JSON.stringify(s)),i+=t.length}}),i}static updateOrderStatus(e,t){let r=localStorage.getItem(a),s=r?JSON.parse(r):[],n=s.findIndex(t=>t.id===e);return -1!==n&&(s[n].status=t,localStorage.setItem(a,JSON.stringify(s)),!0)}static getUserStats(e){let t=this.getUserOrders(e),r=t.length,a=t.reduce((e,t)=>e+t.total,0),s=Math.floor(a/10),n={};return t.forEach(e=>{e.products.forEach(e=>{let t="Saint-Valentin";n[t]=(n[t]||0)+1})}),{totalOrders:r,totalSpent:a,favoriteCategory:Object.keys(n).reduce((e,t)=>n[e]>n[t]?e:t,"Saint-Valentin"),memberSince:"D\xe9cembre 2025",loyaltyPoints:s,nextReward:s>=500?"R\xe9duction de -50€ disponible !":"-50€ sur prochaine commande (".concat(500-s," points)")}}static updateUserStats(e,t){let r=this.getUserStats(e);localStorage.setItem("".concat("flocon_user_stats","_").concat(e),JSON.stringify(r))}static createOrderFromCart(e,t,r){let a=t.map(e=>({id:e.id,name:e.name,price:e.price,quantity:e.quantity,image:e.images[0]})),s=t.reduce((e,t)=>e+t.price*t.quantity,0),n=t.reduce((e,t)=>e+t.quantity,0);return this.addOrder({userId:e,status:"En attente",total:s,items:n,products:a,shippingAddress:r})}}}},e=>{e.O(0,[8096,7358],()=>e(e.s=3629)),_N_E=e.O()}]);