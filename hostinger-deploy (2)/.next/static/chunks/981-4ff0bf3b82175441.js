"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[981,8525],{3856:(e,t,r)=>{function i(e){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e)&&e.length<=255}function a(e){return"string"==typeof e&&e.trim().length>=2&&e.trim().length<=100&&/^[a-zA-Z\s\-'\u00C0-\u017F]+$/.test(e.trim())}function n(e){return"string"==typeof e&&e.trim().length>=5&&e.trim().length<=200&&/^[0-9a-zA-Z\s\-'\.,\u00C0-\u017F]+$/.test(e.trim())}function s(e){return"string"==typeof e&&e.trim().length>=2&&e.trim().length<=100&&/^[a-zA-Z\s\-'\u00C0-\u017F]+$/.test(e.trim())}function o(e){return"string"==typeof e&&/^[0-9]{5}$/.test(e.trim())}function u(e){let t=e.replace(/[\s\.\-]/g,"");return"string"==typeof e&&(/^(\+33|0)[1-9][0-9]{8}$/.test(t)||/^\+?[1-9][0-9]{7,14}$/.test(t))}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FR",r=e.replace(/[\s\.\-]/g,"");return e&&0!==e.trim().length?/^\+?[1-9][0-9]{7,14}$/.test(r)||/^(\+33|0)[1-9][0-9]{8}$/.test(r)?{isValid:!0,message:"Num\xe9ro valide"}:{isValid:!1,message:({FR:"Num\xe9ro invalide : format fran\xe7ais requis (ex: +33 6 12 34 56 78)",BE:"Num\xe9ro invalide : format belge requis (ex: +32 470 12 34 56)",CH:"Num\xe9ro invalide : format suisse requis (ex: +41 79 123 45 67)",LU:"Num\xe9ro invalide : format luxembourgeois requis (ex: +352 621 123 456)",DE:"Num\xe9ro invalide : format allemand requis (ex: +49 30 12345678)",IT:"Num\xe9ro invalide : format italien requis (ex: +39 06 12345678)",ES:"Num\xe9ro invalide : format espagnol requis (ex: +34 91 123 45 67)",GB:"Num\xe9ro invalide : format britannique requis (ex: +44 20 7123 4567)",US:"Num\xe9ro invalide : format am\xe9ricain requis (ex: +1 555 123 4567)",CA:"Num\xe9ro invalide : format canadien requis (ex: +1 416 123 4567)"})[t]||"Num\xe9ro invalide : format international requis (ex: +33 6 12 34 56 78)"}:{isValid:!1,message:"Le num\xe9ro de t\xe9l\xe9phone est requis"}}function c(e){return e&&"object"==typeof e&&a(e.name)&&n(e.address)&&s(e.city)&&o(e.postalCode)&&u(e.phone)}r.d(t,{$m:()=>n,B9:()=>i,BH:()=>u,Go:()=>l,Lg:()=>c,Wd:()=>s,Zj:()=>o,uV:()=>a})},4389:(e,t,r)=>{r.d(t,{a:()=>i});class i{static setIntent(e){try{let t={...e,timestamp:Date.now()};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(e){}}static getIntent(){try{let e=localStorage.getItem(this.STORAGE_KEY);if(!e)return null;let t=JSON.parse(e);if(Date.now()-t.timestamp>this.EXPIRY_TIME)return this.clearIntent(),null;return t}catch(e){return this.clearIntent(),null}}static clearIntent(){try{localStorage.removeItem(this.STORAGE_KEY)}catch(e){}}static setCheckoutIntent(e){this.setIntent({type:"checkout",timestamp:Date.now(),data:e})}static hasCheckoutIntent(){let e=this.getIntent();return(null==e?void 0:e.type)==="checkout"}}i.STORAGE_KEY="redirect_intent",i.EXPIRY_TIME=18e5},5681:(e,t,r)=>{r.d(t,{_:()=>s});var i=r(9981),a=r(9730),n=r(3856);class s{static createOrderFromCart(e,t,r){if(0===t.length)throw Error("Le panier est vide");if(!(0,n.Lg)(r))throw Error("Adresse de livraison invalide");let a=t.map(e=>({id:e.id,name:e.name,price:e.price,quantity:e.quantity,image:e.image})),s=t.reduce((e,t)=>e+t.price*t.quantity,0),o=t.reduce((e,t)=>e+t.quantity,0);return i.a.addOrder({userId:e,status:"En attente",total:s,items:o,products:a,shippingAddress:r})}static async processPayment(e,t,r){arguments.length>3&&void 0!==arguments[3]&&arguments[3];try{if(!(0,n.Lg)(r))throw Error("Adresse de livraison invalide : v\xe9rifiez tous les champs");await new Promise(e=>setTimeout(e,2e3));let a=this.createOrderFromCart(e,t,r);return i.a.updateOrderStatus(a.id,"Livr\xe9"),{success:!0,orderId:a.id,message:"Paiement r\xe9ussi ! Votre commande est en pr\xe9paration."}}catch(e){return{success:!1,orderId:null,message:e instanceof Error?e.message:"Erreur lors du paiement"}}}static useCheckout(){var e=this;let{user:t}=(0,a.A)();return{checkout:async function(r,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"card";if(!t)throw Error("Utilisateur non connect\xe9");return e.processPayment(t.id,r,i,a)}}}}},8525:(e,t,r)=>{r.d(t,{createClient:()=>a});var i=r(5417);function a(){let e="https://xvczqjkmbfpjkdghvomc.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh2Y3pxamttYmZwamtkZ2h2b21jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0MjA5MjUsImV4cCI6MjA4NDk5NjkyNX0.Qi9gHILEaBylF8ObdcpXqg9n8wrlX46MFSzlIcZbCG0";return e&&t?(0,i.createBrowserClient)(e,t):null}},9730:(e,t,r)=>{r.d(t,{A:()=>l,AuthProvider:()=>u});var i=r(5155),a=r(2115),n=r(8525),s=r(63);let o=(0,a.createContext)(void 0);function u(e){let{children:t}=e,[r,u]=(0,a.useState)(null),[l,c]=(0,a.useState)(null),[d,m]=(0,a.useState)(!0),h=(0,s.useRouter)(),g=(0,n.createClient)();(0,a.useEffect)(()=>{if(!g)return void m(!1);let{data:{subscription:e}}=g.auth.onAuthStateChange((e,t)=>{var r;c(t),u(null!=(r=null==t?void 0:t.user)?r:null),m(!1)});return(async()=>{var e;let{data:{session:t}}=await g.auth.getSession();c(t),u(null!=(e=null==t?void 0:t.user)?e:null),m(!1)})(),()=>{e.unsubscribe()}},[g,h]);let f=async(e,t,r)=>{let i=(0,n.createClient)();if(!i)return{error:{message:"Service d'authentification non disponible"}};let{error:a}=await i.auth.signUp({email:e,password:t,options:{data:r}});return{error:a}},p=async(e,t)=>{let r=(0,n.createClient)();if(!r)return{error:{message:"Service d'authentification non disponible"}};let{error:i}=await r.auth.signInWithPassword({email:e,password:t});return h.refresh(),{error:i}},v=async()=>{let e=(0,n.createClient)();e&&(await e.auth.signOut(),h.refresh())},I=async e=>{let t=(0,n.createClient)();if(!t)return{error:{message:"Service d'authentification non disponible"}};let{error:r}=await t.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});return{error:r}},S=async e=>{let t=(0,n.createClient)();if(!t)return{exists:!1,error:{message:"Service d'authentification non disponible"}};try{var r,i;let{error:a}=await t.auth.signInWithPassword({email:e,password:"dummy-password-for-check-only"});if(null==a||null==(r=a.message)?void 0:r.includes("Invalid login credentials"))return{exists:!1,error:null};if(null==a||null==(i=a.message)?void 0:i.includes("Invalid password"))return{exists:!0,error:null};return{exists:!1,error:a}}catch(e){return{exists:!1,error:e}}},y=async(e,t)=>{let r=(0,n.createClient)();if(!r)return{error:{message:"Service d'authentification non disponible"}};let{error:i}=await r.auth.setSession({access_token:e,refresh_token:t});return i||h.refresh(),{error:i}};return(0,i.jsx)(o.Provider,{value:{user:r,session:l,loading:d,signUp:f,signIn:p,signOut:v,resetPassword:I,checkEmailExists:S,confirmEmail:y},children:t})}function l(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9981:(e,t,r)=>{r.d(t,{a:()=>a});let i="flocon_orders";class a{static getUserOrders(e){let t=localStorage.getItem(i);return(t?JSON.parse(t):[]).filter(t=>t.userId===e)}static addOrder(e){let t={...e,id:"CMD-".concat(Date.now()),date:new Date().toISOString()},r=localStorage.getItem(i),a=r?JSON.parse(r):[];return a.push(t),localStorage.setItem(i,JSON.stringify(a)),this.updateUserStats(e.userId,t),t}static removeDuplicateOrders(e){let t=localStorage.getItem(i),r=t?JSON.parse(t):[],a=r.filter(t=>t.userId===e),n=new Map;a.forEach(e=>{let t="".concat(e.total,"-").concat(e.items);n.has(t)||n.set(t,[]),n.get(t).push(e)});let s=0;return n.forEach((e,t)=>{if(e.length>1){e.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),e[0];let t=e.slice(1),a=r.filter(e=>!t.some(t=>t.id===e.id));localStorage.setItem(i,JSON.stringify(a)),s+=t.length}}),s}static updateOrderStatus(e,t){let r=localStorage.getItem(i),a=r?JSON.parse(r):[],n=a.findIndex(t=>t.id===e);return -1!==n&&(a[n].status=t,localStorage.setItem(i,JSON.stringify(a)),!0)}static getUserStats(e){let t=this.getUserOrders(e),r=t.length,i=t.reduce((e,t)=>e+t.total,0),a=Math.floor(i/10),n={};return t.forEach(e=>{e.products.forEach(e=>{let t="Saint-Valentin";n[t]=(n[t]||0)+1})}),{totalOrders:r,totalSpent:i,favoriteCategory:Object.keys(n).reduce((e,t)=>n[e]>n[t]?e:t,"Saint-Valentin"),memberSince:"D\xe9cembre 2025",loyaltyPoints:a,nextReward:a>=500?"R\xe9duction de -50€ disponible !":"-50€ sur prochaine commande (".concat(500-a," points)")}}static updateUserStats(e,t){let r=this.getUserStats(e);localStorage.setItem("".concat("flocon_user_stats","_").concat(e),JSON.stringify(r))}static createOrderFromCart(e,t,r){let i=t.map(e=>({id:e.id,name:e.name,price:e.price,quantity:e.quantity,image:e.images[0]})),a=t.reduce((e,t)=>e+t.price*t.quantity,0),n=t.reduce((e,t)=>e+t.quantity,0);return this.addOrder({userId:e,status:"En attente",total:a,items:n,products:i,shippingAddress:r})}}}}]);